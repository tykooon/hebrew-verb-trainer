@using HebrewVerb.Application.Feature.VerbModels.Commands
@using HebrewVerb.Application.Models
@inject IMediator _mediator
@inject ISnackbar _snackbar


<MudDialog Style="min-width:50vw">
    <DialogContent>
            <MudText>Удалить модель @Name из списка моделей?</MudText>
            <MudText>(Глаголы принадлежащие данной модели сохранятся в базе)</MudText>
    </DialogContent>
    <DialogActions>
            <MudButton Class="me-6" Variant="Variant.Filled" OnClick="Cancel">ОТМЕНА</MudButton>
            <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="Delete">УДАЛИТЬ</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter]
    public int VerbModelId { get; set; }

    [Parameter]
    public string Name { get; set; } = "";

    [Parameter]
    public EventCallback OnSuccess { get;set; }

    void Cancel() => MudDialog.Cancel();

    async Task Delete()
    {
        var deleteCommand = new DeleteVerbModelCommand(VerbModelId);
        var res = await _mediator.Send(deleteCommand);

        if (res?.IsSuccess == true)
        {
            _snackbar.Add("Verb Model Successfully Deleted", Severity.Success);
            MudDialog.Cancel();
            await OnSuccess.InvokeAsync();
        }
        else
        {
            var errorMsg = string.Join(", ", res?.Errors ?? []);
            _snackbar.Add($"Errors: {errorMsg}", Severity.Error);
        }
    }
}
